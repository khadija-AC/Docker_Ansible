---
  - hosts: all
    tasks:
  
      - name: Deploy Portainer
        community.docker.docker_container:
          name: portainer_test
          image: portainer/portainer-ee
          ports:
             - "9000:9000"
             - "8000:8000"
          volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - portainer_data:/data
          restart_policy: always

      - name: Deploy Watchtower
        community.docker.docker_container:
          name: watchtower
          image: containrrr/watchtower
          command: --schedule "0 0 4 * * *"
          volumes:
            - /var/run/docker.sock:/var/run/docker.sock
          restart_policy: always
  
      - name: Vérifier que le conteneur Portainer EE est déployé
        community.docker.docker_container_info:
          name: portainer_test
        register: portainer_info
  
      - name: Afficher les informations du conteneur
        debug:
                var: portainer_info